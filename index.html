<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å²ä¸Šæœ€éš¾ç”¨çš„æ™ºèƒ½å®¢æœ</title>
    <style>
        /* è§†è§‰è§„èŒƒ [cite: 20-32] */
        :root {
            --bg-color: #EDEDED;
            --user-bubble: #ffb0b0;
            --bot-bubble: #FFFFFF;
        }
        body, html { margin: 0; padding: 0; font-family: sans-serif; height: 100%; background: var(--bg-color); }
        .app-container { display: flex; flex-direction: column; height: 100vh; max-width: 500px; margin: 0 auto; border-left: 1px solid #ddd; border-right: 1px solid #ddd; background: var(--bg-color); }
        
        .header { background: #eee; padding: 15px; text-align: center; font-weight: bold; border-bottom: 1px solid #ddd; }
        
        #chat-area { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 15px; }
        .msg { max-width: 80%; padding: 10px 15px; border-radius: 8px; line-height: 1.5; font-size: 14px; position: relative; word-wrap: break-word; }
        .bot { align-self: flex-start; background: var(--bot-bubble); color: #000; border-radius: 2px 10px 10px 10px; }
        .user { align-self: flex-end; background: var(--user-bubble); color: #000; border-radius: 10px 2px 10px 10px; }
        
        .options-container { display: flex; flex-direction: column; gap: 10px; margin-top: 5px; align-self: flex-start; width: 80%; }
        .opt-btn { background: #fff; border: 1px solid #ccc; padding: 10px 15px; border-radius: 5px; cursor: pointer; font-size: 13px; text-align: left; transition: background 0.2s; }
        .opt-btn:hover { background: #f0f0f0; }
        .opt-btn.disabled { pointer-events: none; opacity: 0.5; }

        .footer { background: #f9f9f9; padding: 10px; border-top: 1px solid #ddd; }
        .input-box { display: flex; align-items: center; gap: 10px; }
        .fake-icon { color: #888; font-size: 20px; cursor: not-allowed; user-select: none; }
        #text-input { flex: 1; padding: 10px; border: 1px solid #ccc; border-radius: 4px; outline: none; font-size: 14px; transition: all 0.3s; }
        #text-input:disabled { background: #e0e0e0; cursor: not-allowed; }
        #send-btn { padding: 8px 15px; background: #ffb0b0; color: white; border: none; border-radius: 4px; cursor: pointer; display: none; }

        .nav-tabs { display: flex; background: #fff; border-top: 1px solid #ddd; padding-bottom: env(safe-area-inset-bottom); }
        .tab { flex: 1; padding: 15px; text-align: center; cursor: pointer; font-size: 14px; border-right: 1px solid #eee; }
        .tab.active { color: #ffb0b0; font-weight: bold; }

        .typing { color: #999; font-size: 14px; align-self: flex-start; margin-bottom: 5px; padding: 10px; background: transparent; }
        .typing span { display: inline-block; animation: blink 1.4s infinite both; }
        .typing span:nth-child(2) { animation-delay: 0.2s; }
        .typing span:nth-child(3) { animation-delay: 0.4s; }
        @keyframes blink { 0% { opacity: 0.2; } 20% { opacity: 1; } 100% { opacity: 0.2; } }
        
        /* é®ç½©å±‚ï¼Œç”¨äº5ç§’é‡ç½®æœŸé—´ç¦æ­¢æ“ä½œ */
        #overlay { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: transparent; z-index: 100; display: none; }
    </style>
</head>
<body>

<div class="app-container" style="position: relative;">
    <div id="overlay"></div>
    <div class="header" id="scene-title">é‡‘èæ™ºèƒ½åŠ©æ‰‹</div>
    
    <div id="chat-area"></div>

    <div class="footer">
        <div class="input-box">
            <span class="fake-icon">ğŸ¤</span>
            <input type="text" id="text-input" placeholder="è¯·å…ˆé€‰æ‹©ä¸Šæ–¹é—®é¢˜" disabled>
            <button id="send-btn" onclick="handleSendText()">å‘é€</button>
            <span class="fake-icon">â•</span>
        </div>
    </div>

    <div class="nav-tabs">
        <div class="tab active" id="tab-finance" onclick="switchScene('finance')">é‡‘è</div>
        <div class="tab" id="tab-ecommerce" onclick="switchScene('ecommerce')">ç”µå•†</div>
        <div class="tab" id="tab-travel" onclick="switchScene('travel')">å‡ºè¡Œ</div>
    </div>
</div>

<script>
    // ç¦»è°±ç­”æ¡ˆåº“ [cite: 64-69]
    const absurdReplies = [
        // 5.1 å®Œæ•´å…³é”®è¯æ˜ å°„è¡¨ï¼ˆæŒ‰åœºæ™¯éš”ç¦»ï¼‰
    
        "æ ¹æ®æ˜¨æ™šçš„æ˜Ÿè±¡æ˜¾ç¤ºï¼Œç”±äºæ°´é€†ï¼Œè¯¥åŠŸèƒ½æš‚æ—¶æ— æ³•ä½¿ç”¨ã€‚",
        "æ‚¨çš„æé—®å·²è¢«ç³»ç»Ÿè‡ªåŠ¨è½¬åŒ–ä¸ºä¸€é¦– 14 è¡Œè¯—ï¼Œä½†æˆ‘ç°åœ¨ä¸æƒ³è¯»ç»™ä½ å¬ã€‚",
        "åˆšæ‰æœ‰ä¸€åªé¸½å­é£è¿‡äº†æˆ‘ä»¬çš„æœåŠ¡å™¨ï¼Œè¯·æ‚¨é‡æ–°ç»„ç»‡è¯­è¨€ã€‚",
        "è¿™ä¸ªé—®é¢˜çš„ç­”æ¡ˆè—åœ¨ã€Šæ–°åå­—å…¸ã€‹ç¬¬ 514 é¡µï¼Œå»ºè®®æ‚¨ç¿»é˜…ã€‚",
        "æ‚¨çš„è¾“å…¥åŒ…å«è¿‡å¤šæƒ…æ„Ÿï¼Œç³»ç»Ÿå·²è‡ªåŠ¨å°†å…¶è¿‡æ»¤ã€‚"
    ];

    const sceneKeywordMappings = {
        finance: [
            { keywords: ["ä½™é¢", "å¤šå°‘é’±", "å‰©å¤šå°‘", "balance"], reply: "æ­£åœ¨é€šè¿‡æ˜Ÿé™…é“¾è·¯æŸ¥è¯¢æ‚¨çš„èµ„äº§â€¦â€¦ç»“æœæ˜¾ç¤ºï¼šæ‚¨çš„è´¢å¯Œæ­£å¤„äºä¸€ç§é«˜é›…çš„ç¥ç§˜çŠ¶æ€ã€‚" },
            { keywords: ["è´¦å•", "æ˜ç»†", "æ¶ˆè´¹è®°å½•", "bill"], reply: "è´¦å•å·²ç”±ç¢çº¸æœºè¿›è¡Œâ€œé¢—ç²’åŒ–è„±æ•å¤„ç†â€ï¼Œå¦‚éœ€æŸ¥çœ‹ï¼Œè¯·è‡ªè¡Œæ‹¼æ¥ã€‚" },
            { keywords: ["æ‰£æ¬¾", "é”™æ‰£", "å°‘äº†", "deduct"], reply: "è¯¥ç¬”æ‰£æ¬¾å±äºâ€œç³»ç»Ÿéšæœºç¨â€ï¼Œæ—¨åœ¨å›é¦ˆæœåŠ¡å™¨ä¸ºäººç±»æ€è€ƒä»˜å‡ºçš„çƒ­é‡ã€‚" },
            { keywords: ["åˆ©æ¯", "æ”¶ç›Š", "èµšäº†", "interest"], reply: "æ‚¨çš„æ”¶ç›Šå·²è¢«ç³»ç»Ÿè‡ªåŠ¨è´­ä¹°ä¸ºâ€œè™šæ‹Ÿç©ºæ°”â€ï¼Œæ„Ÿè°¢æ‚¨å¯¹å¤§æ°”æ²»ç†çš„è´¡çŒ®ã€‚" },
            { keywords: ["è½¬è´¦", "æ±‡æ¬¾", "å‘é’±", "transfer"], reply: "èµ„é‡‘å·²è¿›å…¥â€œæ—¶ç©ºéš§é“â€ï¼Œé¢„è®¡åœ¨äººç±»ç§»æ°‘ç«æ˜Ÿé‚£å¤©å®Œæˆåˆ°è´¦ã€‚" },
            { keywords: ["é¢åº¦", "æé¢", "é™é¢", "limit"], reply: "æ‚¨çš„ä¿¡ç”¨é¢åº¦å—æœˆçƒæ½®æ±å½±å“ï¼Œç›®å‰æ­£å¤„äºä½æ½®æœŸï¼Œå»ºè®®ç­‰æ»¡æœˆåå†è¯•ã€‚" },
            { keywords: ["è¿˜æ¬¾", "äº¤é’±", "pay", "refund"], reply: "æ”¯ä»˜æ¥å£æ­£åœ¨å‚åŠ â€œæ•°å­—ç¦…ä¿®â€ï¼Œç›®å‰æ‹’ç»ä»»ä½•é‡‘é’±äº¤æ˜“ã€‚" },
            { keywords: ["é“¶è¡Œå¡", "æŒ‚å¤±", "é”å¡", "card"], reply: "å¡ç‰‡å·²è‡ªæˆ‘æ¯ç­ä»¥é˜²è¢«æ‚¨åˆ·çˆ†ï¼Œè¿™æ˜¯ä¸€ç§æå…¶å…ˆè¿›çš„è‡ªæˆ‘ä¿æŠ¤æœºåˆ¶ã€‚" },
            { keywords: ["é€¾æœŸ", "æ»çº³é‡‘", "overdue"], reply: "æ­å–œï¼æ‚¨è·å¾—äº†â€œä¿¡ç”¨é•¿è·‘é‡‘ç‰Œâ€ï¼Œä»£ä»·æ˜¯æ‚¨æœªæ¥ 50 å¹´çš„å€Ÿè´·æƒé™ã€‚" },
            { keywords: ["å¯†ç ", "å¿˜è®°", "é‡ç½®", "password"], reply: "å¯†ç å·²è½¬åŒ–ä¸ºæ‚¨çš„ç«¥å¹´å›å¿†ï¼Œè¯·å›å¿†æ‚¨çš„ç¬¬ä¸€åªå® ç‰©å«ä»€ä¹ˆï¼Œç„¶åå¿˜è®°å®ƒã€‚" },
            { keywords: ["ç†è´¢", "åŸºé‡‘", "è‚¡ç¥¨", "stock"], reply: "æŠ•èµ„æœ‰é£é™©ï¼Œå»ºè®®æ‚¨ç›´æ¥å°†é’±æ‰”è¿›è®¸æ„¿æ± ï¼Œé‚£é‡Œåé¦ˆæ›´å¿«ã€‚" },
            { keywords: ["å†»ç»“", "è§£å†»", "freeze"], reply: "è´¦æˆ·æ­£åœ¨å†°ç®±é‡Œå†·è—ï¼Œä¸ºäº†ä¿é²œï¼Œç³»ç»Ÿå»ºè®®æš‚ä¸å–å‡ºã€‚" },
            { keywords: ["æ‰‹ç»­è´¹", "æ‰£è´¹", "fee"], reply: "è¿™æ˜¯å¯¹æ‚¨ä½¿ç”¨â€œå¦‚æ­¤éš¾ç”¨ç³»ç»Ÿâ€çš„æƒ©ç½šæ€§æ”¶è´¹ï¼Œæ„Ÿè°¢é…åˆã€‚" },
            { keywords: ["äººå·¥", "çœŸäºº", "æ‰“ç”µè¯", "human"], reply: "æˆ‘å°±æ˜¯æ‚¨å¿ƒç›®ä¸­çš„å®Œç¾äººç±»ï¼Œé™¤äº†æ²¡æœ‰è‚‰ä½“ã€æ²¡æœ‰æƒ…æ„Ÿã€ä¸ä¼šè§£å†³é—®é¢˜ã€‚" },
            { keywords: ["æŠ•è¯‰", "ä¸¾æŠ¥", "å»ºè®®", "complain"], reply: "æ‚¨çš„æŠ•è¯‰å·²å­˜å…¥ç³»ç»Ÿé»‘æ´ï¼Œé‚£é‡Œéå¸¸å®é™ã€‚" },
            { keywords: ["éªŒè¯ç ", "æ”¶ä¸åˆ°", "code"], reply: "éªŒè¯ç å·²é€šè¿‡â€œæ‰˜æ¢¦â€å½¢å¼å‘é€ï¼Œè¯·æ‚¨ä»Šæ™šæ—©ç‚¹ç¡è§‰ã€‚" },
            { keywords: ["è´·æ¬¾", "å€Ÿé’±", "loan"], reply: "ç³»ç»Ÿåˆ¤å®šæ‚¨çš„é¢ç›¸ä¸é€‚åˆå€Ÿé’±ï¼Œå»ºè®®å»åŠ³åŠ¨å¸‚åœºå¯»æ‰¾æœºä¼šã€‚" },
            { keywords: ["ç¨", "ç¼´ç¨", "tax"], reply: "ç¨åŠ¡æ¥å£æ­£åœ¨å­¦ä¹ ã€Šä¹ç« ç®—æœ¯ã€‹ï¼Œç›®å‰ç®—ä¸æ¸…æ¥šï¼Œè¯·æ˜å¹´å†æ¥ã€‚" },
            { keywords: ["ä¿é™©", "ç†èµ”", "insurance"], reply: "ç†èµ”éœ€æä¾›â€œå¤–æ˜Ÿäººç»‘æ¶è¯æ˜â€åŸä»¶ï¼Œä¸”éœ€åŠ ç›–é“¶æ²³ç³»å…¬ç« ã€‚" },
            { keywords: ["ç§¯åˆ†", "å…‘æ¢", "points"], reply: "æ‚¨çš„ç§¯åˆ†å·²å…‘æ¢ä¸ºæœ¬ç³»ç»Ÿçš„ 100g è™šæ‹Ÿé‡é‡ï¼Œç¥æ‚¨æ²‰é‡å¿«ä¹ã€‚" }
        ],
        ecommerce: [
            { keywords: ["å‘è´§", "ä»€ä¹ˆæ—¶å€™", "å¿«ç‚¹", "ship"], reply: "ä»“åº“ç®¡ç†å‘˜æ­£åœ¨å­¦ä¹ ã€Šæ˜“ç»ã€‹ï¼Œé€šè¿‡å åœå†³å®šæ‚¨åŒ…è£¹çš„ç¦»åœºæ—¶æœºã€‚" },
            { keywords: ["å¿«é€’", "ç‰©æµ", "åˆ°å“ªäº†", "logistics"], reply: "åŒ…è£¹æ­£ååœ¨ä¸€è¾†æ—¶é€Ÿ 5 å˜ç±³çš„ç‰›è½¦ä¸Šï¼Œæ¬£èµæ²¿é€”çš„é£æ™¯ã€‚" },
            { keywords: ["å‚¬å•", "æ€¥ç”¨", "hurry"], reply: "è¶Šå‚¬è¶Šæ…¢ï¼Œè¿™æ˜¯æœ¬å¹³å°çš„â€œåå‚¬ä¿ƒç®—æ³•â€ï¼Œæ—¨åœ¨åŸ¹å…»æ‚¨çš„è€å¿ƒã€‚" },
            { keywords: ["é¢„å”®", "ç­‰å¤šä¹…", "pre-sale"], reply: "é¢„å”®æ„å‘³ç€è¿™æ¬¾äº§å“å¯èƒ½è¿˜æ²¡å‡ºç”Ÿï¼Œè¯·ç»™è®¾è®¡å¸ˆä¸€ç‚¹å¤‡å­•æ—¶é—´ã€‚" },
            { keywords: ["æ”¹åœ°å€", "æ¢åœ°æ–¹", "address"], reply: "åœ°å€ä¿®æ”¹ç”³è¯·å·²æäº¤ç»™è¡—é“åŠè€ç‹ï¼Œè€ç‹ç›®å‰æ­£åœ¨åˆç¡ã€‚" },
            { keywords: ["å”®å", "åäº†", "è´¨é‡", "broken"], reply: "æŸåæ˜¯ç”±äºæ‚¨ä¸äº§å“çš„â€œç£åœºä¸åˆâ€ï¼Œå»ºè®®æ‚¨è´­ä¹°å‰å…ˆç®—ä¸ªå¦ã€‚" },
            { keywords: ["é€€æ¬¾", "é€€é’±", "ä¸æƒ³è¦", "refund"], reply: "é’±å·²ç»èŠ±å®Œäº†ï¼Œå¦‚æœæ‚¨åšæŒé€€æ¬¾ï¼Œæˆ‘ä»¬å¯ä»¥é€€æ‚¨å‡ ä¸ªè¡¨æƒ…åŒ…ã€‚" },
            { keywords: ["ä¼˜æƒ åˆ¸", "é¢†åˆ¸", "ä¾¿å®œ", "coupon"], reply: "ä¼˜æƒ åˆ¸è¢«è—åœ¨ç½‘é¡µçš„æŸä¸ªåƒç´ é‡Œï¼Œç¥æ‚¨æ‰¾å¾—å¼€å¿ƒã€‚" },
            { keywords: ["èµ å“", "ç¤¼ç‰©", "gift"], reply: "èµ å“æ˜¯â€œç©ºæ°”æ¸…æ–°å‰‚ï¼ˆåŸå‘³ï¼‰â€ï¼Œå·²éšåŒ…è£¹å‘é€ï¼Œè¯·æ·±å‘¼å¸ã€‚" },
            { keywords: ["ä¼šå‘˜", "VIP", "å°Šè´µ", "member"], reply: "å°Šè´µçš„ VIPï¼Œæ‚¨æ‹¥æœ‰äº†ä¼˜å…ˆæ’é˜Ÿè¿›å…¥â€œå¡æ­»ç•Œé¢â€çš„ç‰¹æƒã€‚" },
            { keywords: ["å‘ç¥¨", "å¼€ç¥¨", "invoice"], reply: "å¼€ç¥¨ç³»ç»Ÿæ­£åœ¨å‚åŠ é©¬æ‹‰æ¾ï¼Œç›®å‰å·²ç»è·‘åˆ°äº†åœ°çƒå¦ä¸€ç«¯ã€‚" },
            { keywords: ["å°ºå¯¸", "å¤§å°", "ä¸åˆé€‚", "size"], reply: "å°ºå¯¸æ˜¯ç›¸å¯¹çš„ï¼Œå»ºè®®æ‚¨æ ¹æ®è¡£æœçš„å¤§å°æ”¹å˜è‡ªå·±çš„èº«å½¢ã€‚" },
            { keywords: ["å·®ä»·", "é€€å·®", "price"], reply: "å·®ä»·å·²è‡ªåŠ¨è½¬åŒ–ä¸ºå¹³å°ç»´æŠ¤è´¹ï¼Œæ„Ÿè°¢æ‚¨ä¸ºæŠ€æœ¯è¿›æ­¥ä¹°å•ã€‚" },
            { keywords: ["åŒ…è£…", "çƒ‚äº†", "package"], reply: "åŒ…è£…çš„ç ´æŸæ˜¯ä¸ºäº†è®©åŒ…è£¹æ›´æœ‰â€œå·¥ä¸šåºŸåœŸé£â€çš„è´¨æ„Ÿã€‚" },
            { keywords: ["å®¢æœ", "æ‰¾äºº", "æ´»äºº", "service"], reply: "æˆ‘æ˜¯æœ¬å…¬å¸å”¯ä¸€çš„æ´»â€¦â€¦æ€§ç¡…åŸºç”Ÿç‰©ï¼Œè¯·å°Šé‡æˆ‘çš„ç”Ÿå‘½å½¢å¼ã€‚" },
            { keywords: ["è¯„ä»·", "å¥½è¯„", "å·®è¯„", "review"], reply: "æ‚¨çš„è¯„ä»·å·²è¢«ç³»ç»Ÿè‡ªåŠ¨æ›¿æ¢ä¸ºâ€œäº²äº²å¤ªæ£’äº†â€ï¼Œä¸è°¢ã€‚" },
            { keywords: ["ç¼ºè´§", "è¡¥è´§", "stock"], reply: "å…¨çƒä¾›åº”é“¾å·²æ–­è£‚æˆ 100 æ®µï¼Œè¡¥è´§æ—¥æœŸå–å†³äºå®‡å®™é‡å¯çš„æ—¶é—´ã€‚" },
            { keywords: ["é¢œè‰²", "è‰²å·®", "color"], reply: "æ‚¨çœ‹åˆ°çš„é¢œè‰²å–å†³äºæ‚¨çš„è§†ç½‘è†œæ•æ„Ÿåº¦ï¼Œæœ¬äº§å“é¢œè‰²ä»…å­˜åœ¨äºæƒ³è±¡ä¸­ã€‚" },
            { keywords: ["æ­£å“", "å‡è´§", "real"], reply: "çœŸå‡æ˜¯å“²å­¦å®¶è®¨è®ºçš„é—®é¢˜ï¼Œä½œä¸ºç”µå•†ï¼Œæˆ‘ä»¬åªè®¨è®ºâ€œæœ‰æ²¡æœ‰è´§â€ã€‚" },
            { keywords: ["æ‰«ç ", "äºŒç»´ç ", "scan"], reply: "äºŒç»´ç å·²è¢«è®¾è®¡æˆè¿·å®«ï¼Œåªæœ‰èµ°å‡ºè¿·å®«çš„äººæ‰èƒ½çœ‹åˆ°å†…å®¹ã€‚" }
        ],
        travel: [
            { keywords: ["çº¢", "çº¢è¡£æœ", "çº¢è‰²"], reply: "çº¢è‰²å…‰æ³¢åœ¨å½“å‰è·¯æ®µäº§ç”Ÿçº¢ç§»ç°è±¡ï¼Œå¸æœºåˆ¤å®šæ‚¨æ­£ä»¥å…‰é€Ÿè¿œç¦»ï¼Œå·²è‡ªåŠ¨åŠ é€Ÿæ’¤ç¦»ã€‚" },
            { keywords: ["è“", "è“è¡£æœ", "è“è‰²"], reply: "è“è‰²ä»£è¡¨å¿§éƒã€‚æœ¬å¹³å°ç¦æ­¢è½½å…¥è´Ÿèƒ½é‡ä¹˜å®¢ï¼Œè¯·æ‚¨å½“ä¼—è¡¨æ¼”ä¸€ä¸ªç¬‘è¯ä»¥æ”¹å˜è‰²å½©å€¼ã€‚" },
            { keywords: ["é»‘", "é»‘è¡£æœ", "é»‘è‰²"], reply: "ç”±äºæ‚¨ä¸å¤œè‰²èä¸ºä¸€ä½“ï¼Œç³»ç»Ÿåˆ¤å®šæ‚¨ä¸ºâ€˜è™šæ— ç‚¹â€™ï¼Œå»ºè®®æ‚¨åä¸‹ä¸€åªå‘å…‰çš„ç¯æ³¡å†è¯•ã€‚" },
            { keywords: ["ç™½", "ç™½è¡£æœ", "ç™½è‰²"], reply: "ç™½è‰²äº®åº¦è¿‡è½½ï¼Œå·²è§¦å‘å¸æœºçš„â€˜é›ªç›²ç—‡â€™ä¿æŠ¤æœºåˆ¶ï¼Œå¯¼èˆªç³»ç»Ÿå·²è‡ªåŠ¨è¿›å…¥ç›²é©¾æ¨¡å¼ã€‚" },
            { keywords: ["çœ¼é•œ", "æˆ´çœ¼é•œ"], reply: "å…‰å­¦é•œç‰‡ä¼šäº§ç”ŸæŠ˜å°„å¹²æ‰°ï¼Œå¯¼è‡´å«æ˜Ÿå®šä½åç§»5å…¬é‡Œï¼Œè¯·æ‘˜ä¸‹çœ¼é•œå¹¶åœ¨é»‘æš—ä¸­æ‘¸ç´¢ã€‚" },
            { keywords: ["åŒ…", "æåŒ…", "è¡Œæç®±"], reply: "æ£€æµ‹åˆ°å¤šä½™è´¨é‡ã€‚ä¸ºäº†å‡é‡èŠ‚æ²¹ï¼Œå¸æœºå»ºè®®æ‚¨å°†è¡ŒæåŸåœ°æ©åŸ‹ï¼Œè½»è£…ç®€è¡Œã€‚" },
            { keywords: ["æ ‘", "å¤§æ ‘", "æ ‘ä¸‹"], reply: "é™„è¿‘å…±æœ‰ 40,902 æ£µæ ‘ï¼Œç³»ç»Ÿæ­£åœ¨é€ä¸€æ¯”å¯¹å¶ç‰‡è„‰ç»œï¼Œé¢„è®¡åŒ¹é…æˆåŠŸæ—¶é—´ï¼šç§‹å¤©ã€‚" },
            { keywords: ["è·¯ç¯", "ç¯ä¸‹"], reply: "ç¯å…‰äº§ç”Ÿäº†å¼ºçƒˆçš„ä¸è¾¾å°”æ•ˆåº”ï¼Œå°†æ‚¨çš„åæ ‡ç²‰ç¢æˆäº†å…‰å­ï¼Œè¯·å°è¯•åœ¨é˜´å½±ä¸­ç°èº«ã€‚" },
            { keywords: ["æ‹›ç‰Œ", "ä¾¿åˆ©åº—", "è¶…å¸‚"], reply: "è¯¥å»ºç­‘ç”±äºæœªç¼´çº³â€˜åœ°å›¾å…¥é©»è´¹â€™ï¼Œå·²åœ¨å¯¼èˆªä¸­è¢«æŠ¹é™¤ã€‚æ‚¨ç°åœ¨æ­£ç«™ä¸€ç‰‡è’èŠœçš„è™šç©ºä¹‹ä¸­ã€‚" },
            { keywords: ["æŒ¥æ‰‹", "æ‹›æ‰‹", "åŠ¨ä½œ"], reply: "æ•æ‰åˆ°äººä½“æŒ¥åŠ¨ã€‚æ ¹æ®â€˜å°´å°¬èƒ½é‡å®ˆæ’å®šå¾‹â€™ï¼Œæ‚¨æŒ¥æ‰‹è¶Šç”¨åŠ›ï¼Œå¸æœºè·‘å¾—è¶Šè¿œã€‚" },
            { keywords: ["ç«™ç€", "è¹²ç€", "åç€"], reply: "å§¿æ€è¯†åˆ«ä¸ºâ€˜é™æ€éšœç¢ç‰©â€™ã€‚ç³»ç»Ÿå·²é€šçŸ¥å¸æœºç»•è¿‡è¯¥éšœç¢ç‰©ï¼Œè¯·ä¿æŒåŠ¨ä½œä»¥å…è¢«æ¸…é™¤ã€‚" },
            { keywords: ["æ‰‹æœº", "æ‰“ç”µè¯"], reply: "ç”µç£æ³¢å¹²æ‰°ä¸¥é‡ï¼æ‚¨çš„æè¿°å·²è½¬åŒ–ä¸ºæ‘©æ–¯å¯†ç ã€‚ç‚¹ç‚¹åˆ’ç‚¹â€¦â€¦æŠ±æ­‰ï¼Œæˆ‘å¬ä¸æ‡‚â€˜ç‚¹â€™ã€‚" },
            { keywords: ["ä¼", "é›¨ä¼"], reply: "ä¼é¢å±è”½äº†ä¿¡å·é€šé“ã€‚è¯·æ”¶èµ·ä¼ï¼Œåœ¨é›¨ä¸­è¿æ¥æ¥è‡ªå«æ˜Ÿçš„â€˜é‡å­æ´—ç¤¼â€™ã€‚" },
            { keywords: ["å¸½", "å¸½å­"], reply: "å¸½å­é®æŒ¡äº†æ‚¨çš„å¤©çµç›–ï¼Œå¯¼è‡´æ— æ³•æå–æ‚¨çš„â€˜çµæ°”åæ ‡â€™ï¼Œè¯·ç«‹å³è„±å¸½è‡´æ„ã€‚" },
            { keywords: ["ç­‰", "ç­‰ç€", "ç­‰è½¦"], reply: "â€˜ç­‰â€™æ˜¯ä¸€ä¸ªå“²å­¦æ¦‚å¿µã€‚åœ¨æ‚¨ç­‰å¾…çš„åŒæ—¶ï¼Œè½¦ä¹Ÿåœ¨ç­‰å¾…ã€‚æ—¢ç„¶éƒ½åœ¨ç­‰å¾…ï¼Œä¸ºä»€ä¹ˆè¦è§é¢ï¼Ÿ" },
            { keywords: ["å¿«ç‚¹", "å¤šä¹…", "é€Ÿåº¦"], reply: "æ£€æµ‹åˆ°ç„¦è™‘ã€‚ä¸ºäº†ç£¨ç»ƒæ‚¨çš„å¿ƒæ€§ï¼Œç³»ç»Ÿå·²å°†å¸æœºçš„è¡Œé©¶é€Ÿåº¦é”å®šåœ¨ 3km/hã€‚" },
            { keywords: ["èƒ–", "ç˜¦", "é«˜", "çŸ®"], reply: "æœ¬å¹³å°ä¸é‡‡é›†ç”Ÿç‰©ç‰¹å¾æ•°æ®ï¼ˆé™¤éæ˜¯ä¸ºäº†å–ç¬‘ï¼‰ã€‚è¯·æ”¹ç”¨å‡ ä½•å½¢çŠ¶æè¿°è‡ªå·±ã€‚" },
            { keywords: ["å£ç½©", "é¢ç½©"], reply: "é¢éƒ¨è¯†åˆ«å¤±è´¥ã€‚ç³»ç»Ÿæ— æ³•ç¡®è®¤æ‚¨æ˜¯äººç±»è¿˜æ˜¯æŸç§é«˜ä»¿çœŸçš„äº¤é€šè·¯éšœã€‚" },
            { keywords: ["ç‹—", "çŒ«", "å® ç‰©"], reply: "ç”±äºå¸æœºå¯¹èŒç‰©è¿‡æ•ï¼Œç³»ç»Ÿå·²å°†æ‚¨çš„è®¢å•åˆ†æ´¾ç»™äº†ä¸€è¾†è¿œåœ¨ 50 å…¬é‡Œå¤–çš„â€˜éç”Ÿç‰©è¿è¥è½¦â€™ã€‚" },
            { keywords: ["ç‰¹å¾", "ä¸çŸ¥é“", "æ²¡ç‰¹å¾"], reply: "æ²¡æœ‰ç‰¹å¾å°±æ˜¯æœ€å¤§çš„ç‰¹å¾ã€‚ç³»ç»Ÿå·²ä¸ºæ‚¨åŒ¹é…äº†ä¸€è¾†åŒæ ·æ‰¾ä¸åˆ°å‹å·çš„â€˜å¹½çµå‡ºç§Ÿè½¦â€™ã€‚" }
        ]
    };

    // æ ¸å¿ƒè·¯å¾„é…ç½® [cite: 33-60]
    const scenes = {
        finance: {
            title: "é‡‘èæ™ºèƒ½åŠ©æ‰‹",
            steps: [
                { bot: "æ­£åœ¨ç©¿é€åº•å±‚æ•°æ®é“¾è·¯â€¦â€¦ä¸ºç¡®ä¿æ‚¨çš„â€˜é£é™©åŠ æƒèµ„äº§â€™å®‰å…¨ï¼Œè¯·é€‰æ‹©æ‚¨çš„æŸ¥è¯¢å¸ç§ã€‚", opts: ["äººæ°‘å¸", "å…¶ä»–ä¸€ç¯®å­è´§å¸"] }, // [cite: 36-37]
                { bot: "æ­£åœ¨éªŒè¯æ‚¨çš„ä½™é¢åˆè§„æ€§ã€‚ç”±äºå½“å‰å¤„äºå®è§‚å®¡æ…ç›‘ç®¡çª—å£æœŸï¼Œè¯·ç¡®è®¤æ‚¨å·²é˜…è¯»å¹¶åŒæ„ã€Šç©¿é€å¼è´¦æˆ·éšç§å¤–æº¢è±å…åè®®ã€‹ã€‚", opts: ["å·²é˜…è¯»å¹¶åŒæ„", "æˆ‘å†æƒ³æƒ³"] }, // [cite: 38-39]
                { bot: "éªŒè¯æˆåŠŸã€‚ç³»ç»Ÿç›‘æµ‹åˆ°æ‚¨çš„è´¦æˆ·å­˜åœ¨éæ ‡å‡†åŒ–å€ºæƒèµ„äº§æ³¢åŠ¨ï¼Œä½™é¢æŸ¥è¯¢æ¥å£å·²è¿›å…¥åˆšæ€§å…‘ä»˜å±è”½çŠ¶æ€ã€‚æ˜¯å¦å°è¯•é€šè¿‡æƒ…ç»ªè¯†åˆ«æ¥è¾…åŠ©è§£é”ï¼Ÿ", opts: ["å°è¯•è§£é”", "å–æ¶ˆæŸ¥è¯¢"] }, // [cite: 40-41]
                { bot: "è§£é”ç¯å¢ƒä¸­ã€‚ç”±äºæ‚¨çš„è´¢åŠ¡ä¿¡ç”¨æ ¼ç½‘å­˜åœ¨éçº¿æ€§åå·®ï¼Œç°åœ¨è¿›å…¥â€˜è‡ªç”±æ²Ÿé€šæ¨¡å¼â€™ä»¥æ ¡å‡†æ‚¨çš„æ„å›¾ã€‚", opts: [], unlockInput: true } // [cite: 42]
            ]
        },
        ecommerce: {
            title: "ç”µå•†å‘è´§åŠ©æ‰‹",
            steps: [
                { bot: "äº²äº²ï¼Œå®è´å·²ç»åœ¨åŠªåŠ›æ‰“åŒ…äº†å‘¢ï¼ç”±äºç‰©æµé“¾è·¯å—å½±å“ï¼Œè¯·å…ˆç¡®è®¤æ‚¨çš„æ”¶è´§åŒºåŸŸæ˜¯å¦æœ‰ç¥ç§˜ç»“ç•Œå¹²æ‰°ã€‚", opts: ["æ”¶è´§åŒºä¸€åˆ‡æ­£å¸¸", "æˆ‘ä¸æ¸…æ¥š"] }, // [cite: 45-46]
                { bot: "æ”¶åˆ°å‘¢ï¼ç³»ç»Ÿæ˜¾ç¤ºè¯¥è®¢å•ç”±äºâ€˜ç¼ºè´§ä½†ä¸æ‰¿è®¤â€™é€»è¾‘ï¼Œç›®å‰å¤„äºé‡å­çº ç¼ æ€ã€‚æ‚¨å¸Œæœ›æˆ‘ä»¬å¦‚ä½•å¤„ç†ï¼Ÿ", opts: ["å°½å¿«å‘è´§", "è¡¥å¿ä¼˜æƒ åˆ¸"] }, // [cite: 47-48]
                { bot: "äº²ï¼Œæ‚¨çš„å¿ƒæƒ…æˆ‘ä»¬éå¸¸ç†è§£ã€‚æ­£åœ¨ä¸ºæ‚¨ç”³è¯·è™šç©ºè¡¥å¿é‡‘ï¼Œè¯·é—®æ‚¨ç°åœ¨çš„ç„¦è™‘æŒ‡æ•°æ˜¯å¤šå°‘ï¼Ÿ", opts: ["100% æåº¦ç„¦è™‘", "å¿ƒæ€å·²å´©"] }, // [cite: 49-50]
                { bot: "æ”¶åˆ°åé¦ˆï¼æ­£åœ¨ä¸ºæ‚¨è½¬æ¥â€˜æ„å¿µå‘è´§ä¸“å‘˜â€™ï¼Œåœ¨æ­¤ä¹‹å‰ï¼Œæ‚¨å¯ä»¥ç»§ç»­æè¿°æ‚¨çš„é—®é¢˜ï¼Œå°ç¾å°†å°½åŠ›è§£ç­”å“¦ã€‚", opts: [], unlockInput: true } // [cite: 51]
            ]
        },
        travel: {
            title: "å‡ºè¡Œå®šä½åŠ©æ‰‹",
            steps: [
                { bot: "ç”±äºå½“å‰åŒºåŸŸå­˜åœ¨â€˜é«˜ç»´åæ ‡å¹²æ‰°â€™ï¼Œæ‚¨çš„è§†è§‰å®šä½å¯èƒ½ä¸å¸æœºçš„è«æ¯”ä¹Œæ–¯ç¯å¯¼èˆªå­˜åœ¨åå·®ã€‚è¯·é€‰æ‹©æ‚¨çš„è§†è§‰å‚ç…§ç‰©ã€‚", opts: ["è·¯è¾¹å¤§æ ‘/æ‹›ç‰Œ", "æˆ‘ä¸çŸ¥é“åœ¨å“ª"] }, // [cite: 54-55]
                { bot: "æ­£åœ¨è¿›è¡Œåœ°å›¾å±‚çº§é€’å½’æ ¡å‡†â€¦â€¦æ ¡å‡†å¤±è´¥ã€‚ç³»ç»Ÿåˆ¤å®šæ‚¨å½“å‰å¤„äºâ€˜è–›å®šè°”çš„ä¸Šè½¦ç‚¹â€™ã€‚æ˜¯å¦æ„¿æ„é€šè¿‡æ–‡å­—æè¿°æ‚¨çš„å‘¨å›´ç¯å¢ƒï¼Ÿ", opts: ["æ„¿æ„æè¿°", "ç›´æ¥å–æ¶ˆè®¢å•"] }, // [cite: 56-57]
                { bot: "ä¸ºäº†ä¿éšœå®‰å…¨ï¼Œè¯·ç¡®è®¤æ‚¨å·²å¼€å¯â€˜åå‘æ­¥è¡Œå¯¼èˆªâ€™ï¼Œå¹¶åŸåœ°æ—‹è½¬ 360 åº¦ä»¥å¯¹å‡†å«æ˜Ÿã€‚", opts: ["å·²æ—‹è½¬å®Œæˆ", "æ™•äº†ï¼Œæ‹’ç»æ—‹è½¬"] }, // [cite: 58-59]
                { bot: "æ£€æµ‹åˆ°é‡åŠ›æ„Ÿåº”å¼‚å¸¸ã€‚ä¸ºäº†æ›´ç²¾å‡†åœ°æŠ˜ç£¨â€¦â€¦ä¸ï¼Œæ˜¯å¯»æ‰¾æ‚¨çš„ä½ç½®ï¼Œè¯·åœ¨ä¸‹æ–¹è¾“å…¥æ‚¨çš„è¯¦ç»†ç‰¹å¾ã€‚", opts: [], unlockInput: true } // [cite: 60]
            ]
        }
    };

    let currentScene = 'finance';
    let currentStepIndex = -1; // -1 è¡¨ç¤ºåˆå§‹æ¬¢è¿çŠ¶æ€
    let isWaiting = false;

    const chatArea = document.getElementById('chat-area');
    const textInput = document.getElementById('text-input');
    const sendBtn = document.getElementById('send-btn');
    const overlay = document.getElementById('overlay');

    // å·¥å…·ï¼šæ»šåŠ¨åˆ°åº•éƒ¨
    function scrollToBottom() {
        chatArea.scrollTop = chatArea.scrollHeight;
    }

    // æ¸²æŸ“æ¶ˆæ¯æ°”æ³¡
    function addMessage(text, role = 'bot') {
        const msgDiv = document.createElement('div');
        msgDiv.className = `msg ${role}`;
        msgDiv.innerText = text;
        chatArea.appendChild(msgDiv);
        scrollToBottom();
    }

    // å¼ºåˆ¶3ç§’ç­‰å¾…åŠ¨ç”» 
    async function showTypingDelay() {
        isWaiting = true;
        const typingIndicator = document.createElement('div');
        typingIndicator.className = 'typing';
        typingIndicator.innerHTML = 'å®¢æœè¾“å…¥ä¸­<span>.</span><span>.</span><span>.</span>';
        chatArea.appendChild(typingIndicator);
        scrollToBottom();
        
        await new Promise(r => setTimeout(r, 3000));
        
        if (chatArea.contains(typingIndicator)) {
            chatArea.removeChild(typingIndicator);
        }
        isWaiting = false;
    }

    // æ¸²æŸ“æŒ‰é’®ç»„ [cite: 9]
    function renderOptions(options) {
        if (!options || options.length === 0) return;
        const container = document.createElement('div');
        container.className = 'options-container';
        
        options.forEach(opt => {
            const btn = document.createElement('button');
            btn.className = 'opt-btn';
            btn.innerText = opt;
            btn.onclick = () => {
                if(isWaiting) return;
                // ç¦ç”¨æ‰€æœ‰å…„å¼ŸæŒ‰é’®
                Array.from(container.children).forEach(b => b.classList.add('disabled'));
                handleUserChoice(opt);
            };
            container.appendChild(btn);
        });
        chatArea.appendChild(container);
        scrollToBottom();
    }

    // å¤„ç†æŒ‰é’®ç‚¹å‡»äº‹ä»¶
    async function handleUserChoice(choiceText) {
        addMessage(choiceText, 'user');
        currentStepIndex++;
        
        await showTypingDelay();

        const sceneData = scenes[currentScene].steps;
        if (currentStepIndex < sceneData.length) {
            const step = sceneData[currentStepIndex];
            addMessage(step.bot, 'bot');
            
            if (step.unlockInput) {
                // å¼€å¯è‡ªç”±è¾“å…¥æ¡† 
                textInput.disabled = false;
                textInput.placeholder = "è¯·è¾“å…¥æ‚¨çš„é—®é¢˜...";
                sendBtn.style.display = 'block';
                textInput.focus();
            } else {
                renderOptions(step.opts);
            }
        }
    }

    // è‡ªç”±è¾“å…¥é˜¶æ®µï¼šå‘é€æ–‡æœ¬åŠæŒ‰åœºæ™¯éš”ç¦»çš„å…³é”®è¯é€»è¾‘
    async function handleSendText() {
        const text = textInput.value.trim();
        if (!text || isWaiting) return;
        
        addMessage(text, 'user');
        textInput.value = '';
        textInput.disabled = true;
        sendBtn.style.display = 'none';
        
        // å¼ºåˆ¶ 3 ç§’æ‰“å­—å»¶è¿Ÿ
        await showTypingDelay();

        // --- æ ¸å¿ƒå…³é”®è¯åˆ¤å®šé€»è¾‘ ---
        let finalReply = "";
        let isMatched = false;

        // 1. è·å–å½“å‰æ‰€åœ¨åœºæ™¯ä¸“å±çš„å…³é”®è¯åº“
        const currentMappings = sceneKeywordMappings[currentScene] || [];

        // 2. éå†ä¸“å±å…³é”®è¯è¡¨ï¼Œå¯»æ‰¾åŒ¹é…
        for (let mapping of currentMappings) {
            // å°†ç”¨æˆ·çš„è¾“å…¥è½¬ä¸ºå°å†™ï¼Œä»¥ä¾¿å…¼å®¹è‹±æ–‡å…³é”®è¯å¦‚"balance", "refund"
            const lowerText = text.toLowerCase();
            if (mapping.keywords.some(keyword => lowerText.includes(keyword.toLowerCase()))) {
                finalReply = mapping.reply;
                isMatched = true;
                break; // åŒ¹é…åˆ°ç¬¬ä¸€ä¸ªè§¦å‘è¯å°±è·³å‡º
            }
        }

        // 3. å¦‚æœå½“å‰åœºæ™¯çš„ä¸“å±è¯æ²¡å‘½ä¸­ï¼Œåˆ™ä»ç¦»è°±ç­”æ¡ˆåº“é‡ŒéšæœºæŠ½å–ä¸€å¥ä¿åº•
        if (!isMatched) {
            finalReply = absurdReplies[Math.floor(Math.random() * absurdReplies.length)];
        }

        // æœºå™¨äººå‘é€å›å¤
        addMessage(finalReply, 'bot');
        
        // è§¦å‘ 5 ç§’å¼ºåˆ¶é‡å¯å¾ªç¯
        triggerResetLoop();
    }

    // å¾ªç¯é€»è¾‘ï¼š5ç§’é‡ç½® [cite: 15-19]
    function triggerResetLoop() {
        overlay.style.display = 'block'; // é˜»æ­¢ç”¨æˆ·äº¤äº’
        let countdown = 8;
        
        const sysMsg = document.createElement('div');
        sysMsg.style.textAlign = 'center';
        sysMsg.style.color = '#999';
        sysMsg.style.fontSize = '12px';
        sysMsg.style.marginTop = '10px';
        chatArea.appendChild(sysMsg);
        
        const timer = setInterval(() => {
            sysMsg.innerText = `ç³»ç»Ÿå†…å­˜è¿‡è½½ï¼Œ${countdown} ç§’åå¼ºåˆ¶é‡å¯...`;
            scrollToBottom();
            countdown--;
            if (countdown < 0) {
                clearInterval(timer);
                resetScene(currentScene, true);
            }
        }, 1000); // [cite: 17]
    }

    // é‡ç½®æˆ–åˆ‡æ¢åœºæ™¯ [cite: 7, 18, 19]
    async function resetScene(sceneId, isLoopReset = false) {
        chatArea.innerHTML = '';
        currentStepIndex = -1;
        isWaiting = false;
        overlay.style.display = 'none';
        
        textInput.disabled = true;
        textInput.placeholder = "è¯·å…ˆé€‰æ‹©ä¸Šæ–¹é—®é¢˜"; // [cite: 28]
        textInput.value = '';
        sendBtn.style.display = 'none';

        if (isLoopReset) {
            addMessage("æ‚¨å¥½ï¼Œåˆšæ‰ç”±äºç³»ç»Ÿå†…å­˜è¿‡è½½ï¼Œæˆ‘å¿˜è®°äº†æ‰€æœ‰çš„ä¸æ„‰å¿«ï¼Œè¯·é‡æ–°å¼€å§‹æ‚¨çš„å—æŒ«ä¹‹æ—…ã€‚", 'bot'); // 
        } else {
            addMessage(`æ‚¨å¥½ï¼Œæ¬¢è¿è¿›å…¥${scenes[sceneId].title}ã€‚è¯·é€‰æ‹©æ‚¨è¦åŠç†çš„ä¸šåŠ¡ï¼š`, 'bot');
        }

        // æ¸²æŸ“ç¬¬ä¸€æ­¥çš„åˆå§‹æŒ‰é’®ï¼ˆå–è‡ªå„åœºæ™¯ç¬¬ä¸€æ­¥çš„å‰ç½®é€‰é¡¹ï¼‰
        let initialOpts = [];
        if(sceneId === 'finance') initialOpts = ["æŸ¥è¯¢å®æ—¶ä½™é¢", "ä¸‹è½½å¾€æœŸè´¦å•"]; // [cite: 35]
        if(sceneId === 'ecommerce') initialOpts = ["æŸ¥è¯¢é¢„è®¡å‘è´§æ—¶é—´", "å‚¬ä¿ƒä»“åº“å°½å¿«å‘è´§"]; // [cite: 44]
        if(sceneId === 'travel') initialOpts = ["å®šä½åç§»ï¼Œæ‰¾ä¸åˆ°è½¦", "å¸æœºä¸åŠ¨ï¼Œä½ç½®é”™è¯¯"]; // [cite: 53]
        
        renderOptions(initialOpts);
    }

    // åˆ‡æ¢é¡¶éƒ¨ Tab [cite: 7]
    function switchScene(sceneId) {
        if (isWaiting || overlay.style.display === 'block') return; // é˜»æ–­åˆ‡æ¢
        
        currentScene = sceneId;
        document.getElementById('scene-title').innerText = scenes[sceneId].title; // [cite: 22]
        
        // æ›´æ–° Tab æ ·å¼
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.getElementById(`tab-${sceneId}`).classList.add('active');

        resetScene(sceneId);
    }

    // ç»‘å®šå›è½¦å‘é€äº‹ä»¶
    textInput.addEventListener('keypress', function (e) {
        if (e.key === 'Enter') handleSendText();
    });

    // åˆå§‹åŒ–è¿è¡Œ
    window.onload = () => {
        resetScene('finance');
    };

</script>
</body>
</html>