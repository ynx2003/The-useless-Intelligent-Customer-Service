<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å²ä¸Šæœ€éš¾ç”¨çš„æ™ºèƒ½å®¢æœ The Worst Intelligent Customer Service</title>
    <style>
        /* è§†è§‰è§„èŒƒ [cite: 20-32] */
        :root {
            --bg-color: #EDEDED;
            --user-bubble: #ffb0b0;
            --bot-bubble: #FFFFFF;
        }
        body, html { margin: 0; padding: 0; font-family: sans-serif; height: 100%; background: var(--bg-color); }
        .app-container { display: flex; flex-direction: column; height: 100vh; max-width: 500px; margin: 0 auto; border-left: 1px solid #ddd; border-right: 1px solid #ddd; background: var(--bg-color); }
        
        .header { background: #eee; padding: 15px; text-align: center; font-weight: bold; border-bottom: 1px solid #ddd; }
        
        #chat-area { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 15px; }
        .msg { max-width: 80%; padding: 10px 15px; border-radius: 8px; line-height: 1.5; font-size: 14px; position: relative; word-wrap: break-word; }
        .bot { align-self: flex-start; background: var(--bot-bubble); color: #000; border-radius: 2px 10px 10px 10px; }
        .user { align-self: flex-end; background: var(--user-bubble); color: #000; border-radius: 10px 2px 10px 10px; }
        
        .options-container { display: flex; flex-direction: column; gap: 10px; margin-top: 5px; align-self: flex-start; width: 80%; }
        .opt-btn { background: #fff; border: 1px solid #ccc; padding: 10px 15px; border-radius: 5px; cursor: pointer; font-size: 13px; text-align: left; transition: background 0.2s; }
        .opt-btn:hover { background: #f0f0f0; }
        .opt-btn.disabled { pointer-events: none; opacity: 0.5; }

        .footer { background: #f9f9f9; padding: 10px; border-top: 1px solid #ddd; }
        .input-box { display: flex; align-items: center; gap: 10px; }
        .fake-icon { color: #888; font-size: 20px; cursor: not-allowed; user-select: none; }
        #text-input { flex: 1; padding: 10px; border: 1px solid #ccc; border-radius: 4px; outline: none; font-size: 14px; transition: all 0.3s; }
        #text-input:disabled { background: #e0e0e0; cursor: not-allowed; }
        #send-btn { padding: 8px 15px; background: #ffb0b0; color: white; border: none; border-radius: 4px; cursor: pointer; display: none; }

        .nav-tabs { display: flex; background: #fff; border-top: 1px solid #ddd; padding-bottom: env(safe-area-inset-bottom); }
        .tab { flex: 1; padding: 15px; text-align: center; cursor: pointer; font-size: 14px; border-right: 1px solid #eee; }
        .tab.active { color: #ffb0b0; font-weight: bold; }

        .typing { color: #999; font-size: 14px; align-self: flex-start; margin-bottom: 5px; padding: 10px; background: transparent; }
        .typing span { display: inline-block; animation: blink 1.4s infinite both; }
        .typing span:nth-child(2) { animation-delay: 0.2s; }
        .typing span:nth-child(3) { animation-delay: 0.4s; }
        @keyframes blink { 0% { opacity: 0.2; } 20% { opacity: 1; } 100% { opacity: 0.2; } }
        
        /* é®ç½©å±‚ï¼Œç”¨äº5ç§’é‡ç½®æœŸé—´ç¦æ­¢æ“ä½œ */
        #overlay { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: transparent; z-index: 100; display: none; }
    </style>
</head>
<body>

<div class="app-container" style="position: relative;">
    <div id="overlay"></div>
    <div class="header" id="scene-title">é‡‘èæ™ºèƒ½åŠ©æ‰‹ Finance Intelligent Customer Service</div>
    
    <div id="chat-area"></div>

    <div class="footer">
        <div class="input-box">
            <span class="fake-icon">ğŸ¤</span>
            <input type="text" id="text-input" placeholder="è¯·å…ˆé€‰æ‹©ä¸Šæ–¹é—®é¢˜ Please select a question above" disabled>
            <button id="send-btn" onclick="handleSendText()">Send</button>
            <span class="fake-icon">â•</span>
        </div>
    </div>

    <div class="nav-tabs">
        <div class="tab active" id="tab-finance" onclick="switchScene('finance')">Finance</div>
        <div class="tab" id="tab-ecommerce" onclick="switchScene('ecommerce')">E-commerce</div>
        <div class="tab" id="tab-travel" onclick="switchScene('travel')">Travel</div>
    </div>
</div>

<script>
    // ç¦»è°±ç­”æ¡ˆåº“ [cite: 64-69]
    const absurdReplies = [
        // 5.1 å®Œæ•´å…³é”®è¯æ˜ å°„è¡¨ï¼ˆæŒ‰åœºæ™¯éš”ç¦»ï¼‰
    
        "æ ¹æ®æ˜¨æ™šçš„æ˜Ÿè±¡æ˜¾ç¤ºï¼Œç”±äºæ°´é€†ï¼Œè¯¥åŠŸèƒ½æš‚æ—¶æ— æ³•ä½¿ç”¨ã€‚Sorry, according to the stars last night, this function is temporarily unavailable due to Mercury retrograde. Please wait patiently.",
        "æ‚¨çš„æé—®å·²è¢«ç³»ç»Ÿè‡ªåŠ¨è½¬åŒ–ä¸ºä¸€é¦– 14 è¡Œè¯—ï¼Œä½†æˆ‘ç°åœ¨ä¸æƒ³è¯»ç»™ä½ å¬ã€‚Your question has been automatically converted into a 14-line poem by the system, which is outside my business scope. Please wait for a system upgrade or contact human customer service.",
        "åˆšæ‰æœ‰ä¸€åªé¸½å­é£è¿‡äº†æˆ‘ä»¬çš„æœåŠ¡å™¨ï¼Œè¯·æ‚¨é‡æ–°ç»„ç»‡è¯­è¨€ã€‚A pigeon just flew over our server and failed to transmit the content you expressed. Please reorganize your language.",
        "è¿™ä¸ªé—®é¢˜çš„ç­”æ¡ˆè—åœ¨ã€Šæ–°åå­—å…¸ã€‹ç¬¬ 514 é¡µï¼Œå»ºè®®æ‚¨ç¿»é˜…ã€‚The answer to this question is hidden on page 514 of the Xinhua Dictionary. I suggest you take a look.",
        "æ‚¨çš„è¾“å…¥åŒ…å«è¿‡å¤šæƒ…æ„Ÿï¼Œç³»ç»Ÿå·²è‡ªåŠ¨å°†å…¶è¿‡æ»¤ã€‚Your input contains too much emotion, and the system has automatically filtered it out. Please try to express your question in a more neutral way.",
    ];

    // 5.1 å…³é”®è¯æ˜ å°„è¡¨ï¼ˆåˆå§‹åŒ–ä¸ºç©ºï¼Œç­‰å¾… CSV åŠ è½½ï¼‰
    let sceneKeywordMappings = {
        finance: [],
        ecommerce: [],
        travel: []
    };

    // å·¥å…·ï¼šCSV è§£æå™¨
    async function loadKeywordsFromCSV() {
        try {
            const response = await fetch('keywords.csv');
            if (!response.ok) throw new Error("æ–‡ä»¶æœªæ‰¾åˆ°");
            const text = await response.text();
            
            // åœºæ™¯åç§°æ˜ å°„å­—å…¸ (Excelä¸­æ–‡ -> ä»£ç key)
            const sceneMap = {
                "é‡‘è": "finance",
                "ç”µå•†": "ecommerce",
                "å‡ºè¡Œ": "travel"
            };

            const rows = text.split('\n');
            // è·³è¿‡ç¬¬ä¸€è¡Œè¡¨å¤´
            for (let i = 1; i < rows.length; i++) {
                const row = rows[i].trim();
                if (!row) continue;

                // æ­£åˆ™é­”æ³•ï¼šä»…åˆ†å‰²ä¸åœ¨å¼•å·å†…çš„é€—å·
                // è§£å†³ "ä½™é¢, å¤šå°‘é’±" è¿™ç§å†…éƒ¨å«æœ‰é€—å·çš„æƒ…å†µ
                const cols = row.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                
                if (cols.length < 3) continue;

                // æ¸…æ´—æ•°æ®ï¼šå»é™¤é¦–å°¾ç©ºæ ¼å’Œå¼•å·
                const sceneCN = cols[0].trim();
                const rawKeywords = cols[1].trim().replace(/^"|"$/g, ''); 
                const reply = cols[2].trim().replace(/^"|"$/g, '');

                const sceneKey = sceneMap[sceneCN];
                if (sceneKey && sceneKeywordMappings[sceneKey]) {
                    sceneKeywordMappings[sceneKey].push({
                        // æ”¯æŒä¸­æ–‡é€—å·å’Œè‹±æ–‡é€—å·åˆ†å‰²å…³é”®è¯
                        keywords: rawKeywords.split(/,|ï¼Œ/).map(k => k.trim()), 
                        reply: reply
                    });
                }
            }
            console.log("å…³é”®è¯è¡¨åŠ è½½æˆåŠŸï¼", sceneKeywordMappings);

        } catch (error) {
            console.error("CSV åŠ è½½å¤±è´¥:", error);
            // å¦‚æœåŠ è½½å¤±è´¥ï¼Œç»™ä¸€ä¸ªå¼¹çª—æç¤ºï¼ˆé€šå¸¸æ˜¯å› ä¸ºæ²¡ç”¨æœåŠ¡å™¨æ‰“å¼€ï¼‰
            addMessage("ç³»ç»Ÿè­¦å‘Šï¼šæ— æ³•è¯»å–é…ç½®æ–‡ä»¶ã€‚è¯·ç¡®ä¿ä½¿ç”¨ Live Server è¿è¡Œç½‘é¡µã€‚", 'bot');
        }
    }

   // æ ¸å¿ƒè·¯å¾„é…ç½®
    const scenes = {
        finance: {
            title: "é‡‘èæ™ºèƒ½å®¢æœ Finance Intelligent Customer Service",
            // ç¬¬ 1 æ­¥ä¹‹å‰çš„åˆå§‹æŒ‰é’®
            initialOpts: ["æŸ¥è¯¢å®æ—¶ä½™é¢ Check Real-time Balance", "ä¸‹è½½å¾€æœŸè´¦å• Download Past Statements"], 
            steps: [
                { 
                    // ç¬¬ 1 æ­¥å›å¤ (æ ¹æ®åˆå§‹æŒ‰é’®çš„é€‰æ‹©)
                    bot: {
                        "æŸ¥è¯¢å®æ—¶ä½™é¢ Check Real-time Balance": "æ­£åœ¨ç©¿é€åº•å±‚æ•°æ®é“¾è·¯â€¦â€¦ä¸ºç¡®ä¿æ‚¨çš„é£é™©åŠ æƒèµ„äº§å®‰å…¨ï¼Œè¯·é€‰æ‹©æ‚¨çš„æŸ¥è¯¢å¸ç§ã€‚Penetrating the underlying data link... To ensure the safety of your risk-weighted assets, please select your query currency.",
                        "ä¸‹è½½å¾€æœŸè´¦å• Download Past Statements": "æ­£åœ¨è¿ç»“æŸ¥è¯¢å„è´¦æˆ·â€¦â€¦è€ƒè™‘åˆ°æ‚¨èµ„äº§é¢‡ä¸°ï¼Œæ¶ˆè´¹ä¸šåŠ¡æ¶‰åŠå›½åˆ«å¹¿æ³›ï¼Œè¯·é€‰æ‹©æ‚¨çš„æŸ¥è¯¢å¸ç§ã€‚Connecting to query various accounts... Considering your substantial assets and wide-ranging consumption across countries, please select your query currency."
                    },
                    opts: ["äººæ°‘å¸ RMB(yuan)", "å…¶ä»–ä¸€ç¯®å­è´§å¸ Other basket of currencies"] 
                },
                { 
                    // ç¬¬ 2 æ­¥å›å¤
                    bot: {
                        "äººæ°‘å¸ RMB(yuan)": "æ­£åœ¨éªŒè¯æ‚¨çš„è´¦æˆ·åˆè§„æ€§ã€‚ç”±äºå½“å‰å¤„äºå®è§‚å®¡æ…ç›‘ç®¡çª—å£æœŸï¼Œè¯·ç¡®è®¤æ‚¨å·²é˜…è¯»å¹¶åŒæ„ã€Šç©¿é€å¼è´¦æˆ·éšç§å¤–æº¢è±å…åè®®ã€‹ã€‚Verifying your account compliance... As we are currently in a macro-prudential regulatory window, please confirm that you have read and agreed to the 'Penetrating Account Privacy Spillover Exemption Agreement'.",
                        "å…¶ä»–ä¸€ç¯®å­è´§å¸ Other basket of currencies": "æ­£åœ¨éªŒè¯æ‚¨çš„è´¦æˆ·åˆè§„æ€§ã€‚ç”±äºè¿‘æœŸå…³ç¨å¢åŠ ï¼ŒæŸ¥è¯¢éäººæ°‘å¸æ•°æ®å°†å¸¦æ¥å¯èƒ½çš„é¢å¤–çš„è´¹ç”¨ï¼Œè¯·ç¡®è®¤æ‚¨å·²é˜…è¯»å¹¶åŒæ„ã€Šç©¿é€å¼è´¦æˆ·éšç§å¤–æº¢è±å…åè®®ã€‹ã€‚Verifying your account compliance... Due to recent tariff increases, querying non-RMB data may incur additional potential costs. Please confirm that you have read and agreed to the 'Penetrating Account Privacy Spillover Exemption Agreement'."
                    },
                    opts: ["å·²é˜…è¯»å¹¶åŒæ„ Read and Agree", "æˆ‘å†æƒ³æƒ³ Let me think about it"] 
                },
                { 
                    // ç¬¬ 3 æ­¥å›å¤
                    bot: {
                        "å·²é˜…è¯»å¹¶åŒæ„ Read and Agree": "æ„Ÿè°¢æ‚¨çš„é…åˆã€‚æŸ¥è¯¢ç³»ç»Ÿå·²å¼€å¯ï¼Œç³»ç»Ÿç›‘æµ‹åˆ°æ‚¨çš„è´¦æˆ·å­˜åœ¨éæ ‡å‡†åŒ–å€ºæƒèµ„äº§æ³¢åŠ¨ï¼Œåä¸‹å…±å¼€å¯äº†18ä¸ªäº§å“çš„å°é¢è´·æœåŠ¡ï¼ŒæŸ¥è¯¢ç³»ç»Ÿå·²ç»è¿›å…¥ç´§æ€¥ç­›æŸ¥ï¼Œå¹¶å¼€å¯é”å®šçŠ¶æ€ã€‚æ˜¯å¦å°è¯•é€šè¿‡æƒ…ç»ªè¯†åˆ«æ¥ä¸€è¿›æ­¥è¾…åŠ©è§£é”ï¼ŸThank you for your cooperation. The query system is now active. The system has detected non-standard debt asset fluctuations in your account, with 18 small loan services under your name. The query system has entered emergency screening and lock status. Would you like to try using emotion recognition to further assist in unlocking?"
                         ,
                        "æˆ‘å†æƒ³æƒ³ Let me think about it": "è±å…åè®®æœªé€šè¿‡ï¼Œè€ƒè™‘åˆ°æœ¬æ¬¡æŸ¥è¯¢å°†å¸¦æ¥çš„å¯èƒ½çš„è´¦æˆ·é£é™©ï¼Œç³»ç»Ÿå°†é”å®šæ‚¨çš„è´¦æˆ·7å¤©ï¼Œä¸ƒå¤©åå°†æ¢å¤ä½¿ç”¨ã€‚å¦‚éœ€ç«‹å³è§£é”è´¦æˆ·ã€‚è¯·å°è¯•é€šè¿‡æƒ…ç»ªè¯†åˆ«æ¥è¾…åŠ©è§£é”éªŒè¯ç¨‹åºã€‚Waiving agreement not passed. Considering the potential account risks that may arise from this query, the system will lock your account for 7 days, after which it will be restored. If you need to unlock your account immediately, please try using emotion recognition to assist in the unlocking verification process."
                    },
                    opts: ["å°è¯•è§£é” Try to Unlock", "å–æ¶ˆæŸ¥è¯¢ Cancel Query"] 
                },
                { 
                    // ç¬¬ 4 æ­¥å›å¤ (å¼€å¯è¾“å…¥æ¡†)
                    bot: {
                        "å°è¯•è§£é” Try to Unlock": "è§£é”ç¯å¢ƒä¸­ã€‚ç”±äºæ‚¨çš„è´¢åŠ¡ä¿¡ç”¨æ ¼ç½‘å­˜åœ¨éçº¿æ€§åå·®ï¼Œç°åœ¨è¿›å…¥â€˜è‡ªç”±æ²Ÿé€šæ¨¡å¼â€™ä»¥ä¾¿æ‚¨è¿›ä¸€æ­¥å’¨è¯¢ä¸šåŠ¡ã€‚Unlocking... Due to the nonlinear deviation in your financial credit grid, you are now entering 'free communication mode' for further business inquiries.",
                        "å–æ¶ˆæŸ¥è¯¢ Cancel Query": "æŸ¥è¯¢å–æ¶ˆä¸­ã€‚ç”±äºæ‚¨çš„è´¦æˆ·ä¿¡ç”¨æä½³ï¼Œä¸ºäº†è¿›ä¸€æ­¥è§£å†³æ‚¨çš„é—®é¢˜ç°åœ¨è¿›å…¥â€˜è‡ªç”±æ²Ÿé€šæ¨¡å¼â€™ä»¥ä¾¿æ‚¨è¿›ä¸€æ­¥å’¨è¯¢ä¸šåŠ¡ã€‚Canceling query... Due to your excellent account credit, we are now entering 'free communication mode' to further resolve your issues and allow you to inquire about our services."
                    },
                    opts: [], 
                    unlockInput: true 
                }
            ]
        },
        ecommerce: {
            title: "ç”µå•†æ™ºèƒ½å®¢æœ E-commerce Intelligent Custermor Service",
            initialOpts: ["æŸ¥è¯¢é¢„è®¡å‘è´§æ—¶é—´ Query Estimated Delivery Time", "å‚¬ä¿ƒä»“åº“å°½å¿«å‘è´§ Urge Warehouse to Ship Faster"],
            steps: [
                { 
                    bot: {
                        "æŸ¥è¯¢é¢„è®¡å‘è´§æ—¶é—´ Query Estimated Delivery Time": "äº²äº²ï¼Œå®è´å·²ç»åœ¨åŠªåŠ›æ‰“åŒ…äº†å‘¢ï¼ç”±äºç‰©æµå—æ˜¥è¿å½±å“ï¼Œè¯·å…ˆç¡®è®¤æ‚¨çš„æ”¶è´§åŒºåŸŸæ˜¯å¦éäººç±»èšé›†åŒºï¼Œäººæµå¯†é›†å°†å»¶ç¼“åˆ°è´§æ—¶é—´ã€‚Dear, the item is being packed! Due to the impact of the Spring Festival transportation, please first confirm whether your delivery area is a non-human gathering area, as high population density will delay delivery time.",
                        "å‚¬ä¿ƒä»“åº“å°½å¿«å‘è´§ Urge Warehouse to Ship Faster": "äº²äº²ï¼Œå®è´å·²ç»åœ¨åŠªåŠ›æ‰“åŒ…äº†å‘¢ï¼ç”±äºç‰©æµé“¾è·¯å—å½±å“ï¼Œè¯·å…ˆç¡®è®¤æ‚¨çš„æ”¶è´§åŒºåŸŸæ˜¯å¦æœ‰ç¥ç§˜ç»“ç•Œå¹²æ‰°ã€‚Dear, the item is being packed! Due to the impact on the logistics chain, please first confirm whether your delivery area is affected by a mysterious barrier."
                    },
                    opts: ["æ”¶è´§åŒºä¸€åˆ‡æ­£å¸¸ Delivery area is normal", "æˆ‘ä¸æ¸…æ¥š I am not sure"] 
                },
                { 
                    bot: {
                        "æ”¶è´§åŒºä¸€åˆ‡æ­£å¸¸ Delivery area is normal": "æ”¶åˆ°å‘¢ï¼ç³»ç»Ÿæ˜¾ç¤ºè¯¥è®¢å•ç”±äºâ€˜ç¼ºè´§ä½†ä¸æ‰¿è®¤â€™é€»è¾‘ï¼Œç›®å‰å¤„äºé‡å­çº ç¼ æ€ã€‚æ‚¨å¸Œæœ›æˆ‘ä»¬å¦‚ä½•å¤„ç†ï¼ŸUnderstood! The system shows that the order is currently in a quantum entangled state due to the 'out of stock but not admitting' logic. How would you like us to handle this?",
                        "æˆ‘ä¸æ¸…æ¥š I am not sure": "æ”¶åˆ°å‘¢ï¼è™½ç„¶æ— æ³•ç¡®å®šæ‚¨æ”¶è´§åŒºçš„ç›¸å…³ä¿¡æ¯ï¼Œä½†å·²ç»ä¸ºæ‚¨åŠ æ€¥å¤„ç†äº†å‘¢ï¼Œç³»ç»Ÿæ˜¾ç¤ºè¯¥è®¢å•æ­£åœ¨ä¸ºæ‚¨åŠ æ€¥æ‰“åŒ…ï¼Œè¯·æ‚¨è€å¿ƒç­‰å¾…ï¼Œè¿˜æœ‰ä»€ä¹ˆå¯ä»¥ä¸ºæ‚¨æœåŠ¡çš„å‘¢ï¼Œäº²ï¼ŸUnderstood! Although we cannot determine the relevant information about your delivery area, we have expedited the processing for you. The system shows that the order is being expedited for packing. Please be patient. Is there anything else I can assist you with, dear?"
                    },
                    opts: ["å°½å¿«å‘è´§ Ship ASAP", "è¡¥å¿ä¼˜æƒ åˆ¸ Compensation Coupon"] 
                },
                { 
                    bot: {
                        "å°½å¿«å‘è´§ Ship ASAP": "äº²ï¼Œæ‚¨çš„å¿ƒæƒ…æˆ‘ä»¬éå¸¸ç†è§£ã€‚æ­£åœ¨ä¸ºæ‚¨å‚¬ä¿ƒå•†å®¶ï¼Œè€ƒè™‘åˆ°ç°åœ¨å‚¬ä¿ƒä¸šåŠ¡ç¹å¿™ï¼Œæˆ‘ä»¬å°†æ ¹æ®å®¢æˆ·çš„ç„¦è™‘å€¼çš„é«˜ä½ä¾æ¬¡å‘å•†å®¶å‚¬ä¿ƒï¼Œè¯·é—®æ‚¨ç°åœ¨çš„ç„¦è™‘æŒ‡æ•°æ˜¯å¤šå°‘ï¼ŸDear, we understand your feelings very well. We are urging the merchant for you. Considering that the urging business is busy now, we will urge the merchant in order according to the customer's anxiety level. May I ask what your current anxiety index is?"
                         ,
                        "è¡¥å¿ä¼˜æƒ åˆ¸ Compensation Coupon": "äº²ï¼Œæ‚¨çš„å¿ƒæƒ…æˆ‘ä»¬éå¸¸ç†è§£ã€‚æ­£åœ¨ä¸ºæ‚¨ç”³è¯·è™šç©ºè¡¥å¿é‡‘ï¼Œæˆ‘ä»¬å°†æ ¹æ®ç„¦è™‘æŒ‡æ•°çš„ä¸åŒï¼Œå’Œå¾€æœŸç„¦è™‘è®°å½•ä¸ºæ‚¨æä¾›ç›¸åº”çš„è¡¥å¿é‡‘ï¼Œè¯·é—®æ‚¨ç°åœ¨çš„ç„¦è™‘æŒ‡æ•°æ˜¯å¤šå°‘ï¼ŸDear, we understand your feelings very well. We are applying for void compensation for you. We will provide you with corresponding compensation based on different anxiety indices and past anxiety records. May I ask what your current anxiety index is?"
                    },
                    opts: ["100% æåº¦ç„¦è™‘ Extremely anxious", "å¿ƒæ€å·²å´© I am emotionally broken"] 
                },
                { 
                    bot: {
                        "100% æåº¦ç„¦è™‘ Extremely anxious": "æ”¶åˆ°åé¦ˆï¼æ­£åœ¨ä¸ºæ‚¨è½¬æ¥â€˜æ„å¿µå‘è´§ä¸“å‘˜â€™ï¼Œåœ¨æ­¤ä¹‹å‰ï¼Œäº²æ‚¨é€‚å½“æ”¾æ¾ï¼Œå‡ç¼“ç„¦è™‘ï¼Œæ‚¨å¯ä»¥ç»§ç»­æè¿°æ‚¨çš„é—®é¢˜ï¼Œå°ç¾å°†å°½åŠ›è§£ç­”å“¦ã€‚Feedback received! We are transferring you to the 'Mental Delivery Specialist'. In the meantime, please try to relax and reduce your anxiety. You can continue to describe your problem, and Xiaomei will do her best to answer it.",
                        "å¿ƒæ€å·²å´© I am emotionally broken": "æ”¶åˆ°åé¦ˆï¼æ­£åœ¨ä¸ºæ‚¨è½¬æ¥â€˜æ„å¿µå‘è´§ä¸“å‘˜â€™ï¼Œåœ¨æ­¤ä¹‹å‰ï¼Œè¯·æ‚¨ä¿æŒç§¯æçš„å¿ƒæ€ï¼Œæ‚¨å¯ä»¥ç»§ç»­æè¿°æ‚¨çš„é—®é¢˜ï¼Œå°ç¾å°†å°½åŠ›è§£ç­”å“¦ã€‚Feedback received! We are transferring you to the 'Mental Delivery Specialist'. In the meantime, please maintain a positive mindset. You can continue to describe your problem, and Xiaomei will do her best to answer it."
                    },
                    opts: [], 
                    unlockInput: true 
                }
            ]
        },
        travel: {
            title: "å‡ºè¡Œæ™ºèƒ½å®¢æœ Travel Intelligent Customer Service",
            initialOpts: ["å®šä½åç§»ï¼Œæ‰¾ä¸åˆ°è½¦ GPS offset,can't find the car", "å¸æœºä¸åŠ¨ï¼Œä½ç½®é”™è¯¯ Driver is not moving, location is wrong"],
            steps: [
                { 
                    bot: {
                        "å®šä½åç§»ï¼Œæ‰¾ä¸åˆ°è½¦ GPS offset,can't find the car": "ç”±äºå½“å‰åŒºåŸŸå­˜åœ¨é«˜ç»´åæ ‡å¹²æ‰°ï¼Œæ‚¨çš„è§†è§‰å®šä½å¯èƒ½ä¸å¸æœºçš„ä½å¾·å¯¼èˆªå­˜åœ¨åå·®ã€‚è¯·é€‰æ‹©æ‚¨çš„è§†è§‰å‚ç…§ç‰©ï¼Œå¸æœºå°†æ ¹æ®æ‚¨çš„æè¿°ï¼Œå°½å¿«åˆ°è¾¾æ‚¨èº«è¾¹å‘¢ã€‚Due to the current area being affected by high-dimensional coordinate interference, your visual positioning may deviate from the driver's low-precision navigation. Please choose your visual reference, and the driver will get to you as soon as possible based on your description.",
                        "å¸æœºä¸åŠ¨ï¼Œä½ç½®é”™è¯¯ Driver is not moving, location is wrong": "å¸æœºå·²ç»åˆ°è¾¾äº†é¢„å®šä½ç½®å‘¢ï¼Œæ˜¯å¦æœ€è¿‘ç†¬å¤œå¤ªå¤šï¼Œå¤´æ™•çœ¼èŠ±ï¼Œæ‚¨çš„è§†è§‰å®šä½å¯èƒ½ä¸æ‚¨çš„å®é™…ä½ç½®å­˜åœ¨åå·®ã€‚è¯·é€‰æ‹©æ‚¨çš„è§†è§‰å‚ç…§ç‰©ã€‚å¸æœºå°†æ ¹æ®æ‚¨çš„æè¿°ï¼Œå°½å¿«åˆ°è¾¾æ‚¨èº«è¾¹å‘¢ã€‚The driver has arrived at the scheduled location. If you have been staying up late recently and feeling dizzy, your visual positioning may deviate from your actual location. Please choose your visual reference, and the driver will get to you as soon as possible based on your description."
                    },
                    opts: ["è·¯è¾¹å¤§æ ‘/æ‹›ç‰Œ Roadside tree/Signboard", "æˆ‘ä¸çŸ¥é“åœ¨å“ª I don't know where I am"] 
                },
                { 
                    bot: {
                        "è·¯è¾¹å¤§æ ‘/æ‹›ç‰Œ Roadside tree/Signboard": "æ­£åœ¨è¿›è¡Œåœ°å›¾å±‚çº§é€’å½’æ ¡å‡†â€¦â€¦æ ¡å‡†å¤±è´¥ã€‚ç³»ç»Ÿåˆ¤å®šæ‚¨å½“å‰å¤„äºâ€˜è–›å®šè°”çš„ä¸Šè½¦ç‚¹â€™ã€‚æ‚¨æ˜¯å¦æ„¿æ„è¿›è¡Œå®šä½äººå·¥æ ¡å‡†ç¨‹åºä»¥é‡æ–°æ ¡å‡†æ‚¨çš„ä½ç½®ï¼ŸPerforming map-level recursive calibration... Calibration failed. The system has determined that you are currently at the 'SchrÃ¶dinger's pickup point'. Would you like to proceed with the manual positioning calibration process to recalibrate your location?"
                         ,
                        "æˆ‘ä¸çŸ¥é“åœ¨å“ª I don't know where I am": "è€ƒè™‘åˆ°æ‚¨é™„è¿‘å¯èƒ½è¿‡äºè’èŠœäººçƒŸï¼Œæœªå­˜åœ¨å¯æè¿°çš„æ ‡å¿—æ€§è§†è§‰å‚ç…§ç‰©ã€‚æ‚¨æ˜¯å¦æ„¿æ„è¿›è¡Œå®šä½äººå·¥æ ¡å‡†ç¨‹åºä»¥é‡æ–°æ ¡å‡†æ‚¨çš„ä½ç½®ï¼ŸConsering that there may be too few people around you and no identifiable visual reference points, would you like to proceed with the manual positioning calibration process to recalibrate your location?"
                    },
                    opts: ["æ„¿æ„æ ¡å‡† Yes", "ç›´æ¥å–æ¶ˆè®¢å• Cancel Order"] 
                },
                { 
                    bot: {
                        "æ„¿æ„æ ¡å‡† Yes": "ä¸ºäº†ä¿éšœå®‰å…¨ï¼Œè¯·ç¡®è®¤æ‚¨å·²å¼€å¯åå‘æ­¥è¡Œå¯¼èˆªï¼Œå¼€å¯Wi-Fiã€è“ç‰™ã€ä¸ªäººç§»åŠ¨çƒ­ç‚¹å¢å¼ºä¸ªäººä¿¡å·ï¼Œå¹¶åŸåœ°æ—‹è½¬ 360 åº¦ä»¥å¯¹å‡†å«æ˜Ÿã€‚For safety reasons, please confirm that you have enabled reverse walking navigation, turned on Wi-Fi, Bluetooth, and personal mobile hotspot to enhance your signal, and rotate 360 degrees in place to align with the satellite.",
                        "ç›´æ¥å–æ¶ˆè®¢å• Cancel Order": "å¸æœºå·²åœ¨æ‚¨é™„è¿‘è¿·å¤±æ–¹å‘ï¼Œä¸ºäº†å¸æœºä¿éšœå®‰å…¨ï¼Œè¯·æ‚¨ä¸è¦ç§»åŠ¨ä½ç½®ï¼Œå·²è‡ªèº«ä¸ºåŸåæ ‡ï¼Œå¹¶åŸåœ°æ—‹è½¬ 360 åº¦è¾…åŠ©å¸æœºå¼€å¯åå‘å¯¼èˆªï¼Œæ„Ÿè°¢æ‚¨çš„å¸®åŠ© The driver has lost direction near you. For the safety of the driver, please do not move your location. Use yourself as the original coordinate and rotate 360 degrees in place to assist the driver in enabling reverse navigation. Thank you for your help."
                    },
                    opts: ["å·²æ—‹è½¬å®Œæˆ Rotation complete", "æ™•äº†ï¼Œæ‹’ç»æ—‹è½¬ Dizzy, refuse to rotate"] 
                },
                { 
                    bot: {
                        "å·²æ—‹è½¬å®Œæˆ Rotation complete": "æ„Ÿè°¢æ‚¨çš„å¸®åŠ©ï¼Œæ ¡å‡†å·²ç»å®Œæˆï¼Œå¸æœºå³å°†åˆ°è¾¾ã€‚ä¸ºäº†æ›´ç²¾å‡†åœ°æŠ˜ç£¨â€¦â€¦ä¸ï¼Œæ˜¯å¯»æ‰¾æ‚¨çš„ä½ç½®ï¼Œè¯·åœ¨ä¸‹æ–¹è¾“å…¥æ‚¨çš„è¯¦ç»†ç‰¹å¾ï¼Œä»¥ä¾¿å¸æœºåœ¨èŒ«èŒ«äººæµ·ä¸­å¯»æ‰¾åˆ°æ‚¨ï¼Œå¹¶æä¾›æœåŠ¡ã€‚Thank you for your help, the calibration is complete, and the driver will arrive soon. To more accurately torment... I mean, find your location, please enter your detailed features below so that the driver can find you in the vast sea of people and provide service."
                         ,
                        "æ™•äº†ï¼Œæ‹’ç»æ—‹è½¬ Dizzy, refuse to rotate": "æ£€æµ‹åˆ°é‡åŠ›æ„Ÿåº”å¼‚å¸¸ã€‚ä¸ºäº†æ›´ç²¾å‡†åœ°æŠ˜ç£¨â€¦â€¦ä¸ï¼Œæ˜¯å¯»æ‰¾æ‚¨çš„ä½ç½®ï¼Œè¯·åœ¨ä¸‹æ–¹è¾“å…¥æ‚¨çš„è¯¦ç»†ç‰¹å¾ï¼Œä»¥ä¾¿å¸æœºå°½å¿«å¯»æ‰¾åˆ°æ‚¨ï¼Œå¹¶æä¾›å¸®åŠ©ã€‚Gravity sensing anomaly detected. To more accurately torment... I mean, find your location, please enter your detailed features below so that the driver can find you as soon as possible and provide assistance."
                    },
                    opts: [], 
                    unlockInput: true 
                }
            ]
        }
    };

    let currentScene = 'finance';
    let currentStepIndex = -1; // -1 è¡¨ç¤ºåˆå§‹æ¬¢è¿çŠ¶æ€
    let isWaiting = false;
    let queueNumber = 0; // æ–°å¢ï¼šäººå·¥æ’é˜Ÿäººæ•°å…¨å±€å˜é‡

    const chatArea = document.getElementById('chat-area');
    const textInput = document.getElementById('text-input');
    const sendBtn = document.getElementById('send-btn');
    const overlay = document.getElementById('overlay');

    // å·¥å…·ï¼šæ»šåŠ¨åˆ°åº•éƒ¨
    function scrollToBottom() {
        chatArea.scrollTop = chatArea.scrollHeight;
    }

    // æ¸²æŸ“æ¶ˆæ¯æ°”æ³¡
    function addMessage(text, role = 'bot') {
        const msgDiv = document.createElement('div');
        msgDiv.className = `msg ${role}`;
        msgDiv.innerText = text;
        chatArea.appendChild(msgDiv);
        scrollToBottom();
    }

    // å¼ºåˆ¶3ç§’ç­‰å¾…åŠ¨ç”» 
    async function showTypingDelay() {
        isWaiting = true;
        const typingIndicator = document.createElement('div');
        typingIndicator.className = 'typing';
        typingIndicator.innerHTML = 'Typing<span>.</span><span>.</span><span>.</span>';
        chatArea.appendChild(typingIndicator);
        scrollToBottom();
        
        await new Promise(r => setTimeout(r, 3000));
        
        if (chatArea.contains(typingIndicator)) {
            chatArea.removeChild(typingIndicator);
        }
        isWaiting = false;
    }

    // æ¸²æŸ“æŒ‰é’®ç»„ [cite: 9]
    function renderOptions(options) {
        if (!options || options.length === 0) return;
        const container = document.createElement('div');
        container.className = 'options-container';
        
        options.forEach(opt => {
            const btn = document.createElement('button');
            btn.className = 'opt-btn';
            btn.innerText = opt;
            btn.onclick = () => {
                if(isWaiting) return;
                // ç¦ç”¨æ‰€æœ‰å…„å¼ŸæŒ‰é’®
                Array.from(container.children).forEach(b => b.classList.add('disabled'));
                handleUserChoice(opt);
            };
            container.appendChild(btn);
        });
        chatArea.appendChild(container);
        scrollToBottom();
    }

    // å¤„ç†æŒ‰é’®ç‚¹å‡»äº‹ä»¶ï¼ˆå·²ä¿®å¤ [object Object] é—®é¢˜ï¼‰
    async function handleUserChoice(choiceText) {
        // 1. å…ˆæ˜¾ç¤ºç”¨æˆ·çš„æ°”æ³¡
        addMessage(choiceText, 'user');
        
        // 2. æ­¥æ•°å‰è¿›
        currentStepIndex++;
        
        // 3. å¼ºåˆ¶ç­‰å¾…åŠ¨ç”»
        await showTypingDelay();

        // 4. è·å–å½“å‰åœºæ™¯çš„æ•°æ®
        const sceneData = scenes[currentScene].steps;
        
        // 5. åˆ¤æ–­æ˜¯å¦è¿˜æœ‰ä¸‹ä¸€æ­¥
        if (currentStepIndex < sceneData.length) {
            const step = sceneData[currentStepIndex];
            
            // =========== æ ¸å¿ƒä¿®å¤é€»è¾‘å¼€å§‹ ===========
            let replyText = "";

            // åˆ¤æ–­ bot å­—æ®µæ˜¯â€œçº¯æ–‡æœ¬â€è¿˜æ˜¯â€œåˆ†æ”¯å¯¹è±¡â€
            if (typeof step.bot === 'object') {
                // å¦‚æœæ˜¯å¯¹è±¡ï¼Œæ ¹æ®ç”¨æˆ·ç‚¹å‡»çš„æŒ‰é’®æ–‡å­— (choiceText) æå–å¯¹åº”çš„å›å¤
                // ä¾‹å¦‚ï¼šç”¨æˆ·ç‚¹äº†"æŸ¥è¯¢å®æ—¶ä½™é¢"ï¼Œå°±å»å– bot["æŸ¥è¯¢å®æ—¶ä½™é¢"] çš„å€¼
                replyText = step.bot[choiceText] || "ç³»ç»Ÿé€»è¾‘ä¸¢å¤±ï¼Œè¯·é‡æ–°é€‰æ‹©ã€‚"; 
            } else {
                // å¦‚æœæ˜¯ä»¥å‰çš„çº¯æ–‡æœ¬ï¼ˆå…¼å®¹æ—§é€»è¾‘ï¼‰
                replyText = step.bot;
            }
            // =========== æ ¸å¿ƒä¿®å¤é€»è¾‘ç»“æŸ ===========

            // 6. å‘é€ç­›é€‰åçš„æ­£ç¡®æ–‡æœ¬
            addMessage(replyText, 'bot');
            
            // 7. åˆ¤æ–­æ˜¯æ˜¾ç¤ºæŒ‰é’®è¿˜æ˜¯å¼€å¯è¾“å…¥æ¡†
            if (step.unlockInput) {
                textInput.disabled = false;
                textInput.placeholder = "Please enter your question...";
                sendBtn.style.display = 'block';
                textInput.focus();
                // æ»šåŠ¨åˆ°åº•éƒ¨ç¡®ä¿çœ‹åˆ°è¾“å…¥æ¡†
                scrollToBottom();
            } else {
                renderOptions(step.opts);
            }
        }
    }

    // è‡ªç”±è¾“å…¥é˜¶æ®µï¼šå‘é€æ–‡æœ¬åŠæŒ‰åœºæ™¯éš”ç¦»çš„å…³é”®è¯é€»è¾‘
    async function handleSendText() {
        const text = textInput.value.trim();
        if (!text || isWaiting) return;
        
        addMessage(text, 'user');
        textInput.value = '';
        textInput.disabled = true;
        sendBtn.style.display = 'none';
        
        // å¼ºåˆ¶ 3 ç§’æ‰“å­—å»¶è¿Ÿ
        await showTypingDelay();

        // --- æ ¸å¿ƒå…³é”®è¯åˆ¤å®šé€»è¾‘ ---
        let finalReply = "";
        let isMatched = false;

        // 1. è·å–å½“å‰æ‰€åœ¨åœºæ™¯ä¸“å±çš„å…³é”®è¯åº“
        const currentMappings = sceneKeywordMappings[currentScene] || [];

        // 2. éå†ä¸“å±å…³é”®è¯è¡¨ï¼Œå¯»æ‰¾åŒ¹é…
        for (let mapping of currentMappings) {
            // å°†ç”¨æˆ·çš„è¾“å…¥è½¬ä¸ºå°å†™ï¼Œä»¥ä¾¿å…¼å®¹è‹±æ–‡å…³é”®è¯å¦‚"balance", "refund"
            const lowerText = text.toLowerCase();
            if (mapping.keywords.some(keyword => lowerText.includes(keyword.toLowerCase()))) {
                finalReply = mapping.reply;
                isMatched = true;
                break; // åŒ¹é…åˆ°ç¬¬ä¸€ä¸ªè§¦å‘è¯å°±è·³å‡º
            }
        }

        // 3. å¦‚æœå½“å‰åœºæ™¯çš„ä¸“å±è¯æ²¡å‘½ä¸­ï¼Œåˆ™ä»ç¦»è°±ç­”æ¡ˆåº“é‡ŒéšæœºæŠ½å–ä¸€å¥ä¿åº•
        if (!isMatched) {
            finalReply = absurdReplies[Math.floor(Math.random() * absurdReplies.length)];
        }

        // æœºå™¨äººå‘é€å›å¤
        addMessage(finalReply, 'bot');
        
        // è¿›å…¥è¯„ä»·ç¯èŠ‚
        setTimeout(() => {
            showEvaluation();
        }, 1000);
    }

// æ–°å¢ï¼šå±•ç¤ºæœåŠ¡è¯„ä»·é€‰é¡¹
    async function showEvaluation() {
        await showTypingDelay();
        addMessage("ä¸çŸ¥é“æˆ‘ä»¬çš„å›å¤æ‚¨æ˜¯å¦æ»¡æ„ï¼Œè¯·æ‚¨ä¸ºæˆ‘ä»¬çš„æœåŠ¡åšå‡ºè¯„ä»·ï¼Œæˆ‘ä»¬ä¸€å®šä¼šå˜å¾—æ›´å¥½çš„ We are not sure if you are satisfied with our service. Please evaluate our service, and we will definitely improve. Thank you for your feedback.", "bot");
        
        // éšæœºç”Ÿæˆä¸€ä¸ªå¤§äº 100 çš„åˆå§‹æ’é˜Ÿæ•°å­— (ä¾‹å¦‚ 101 åˆ° 999 ä¹‹é—´)
        queueNumber = Math.floor(Math.random() * 899) + 101; 
        
        renderEvalOptions();
    }

    // æ–°å¢ï¼šæ¸²æŸ“è¯„ä»·æŒ‰é’®ï¼ˆç‹¬ç«‹äºæ™®é€šæŒ‰é’®ï¼Œä»¥æ”¯æŒç‰¹æ®Šçš„æ’é˜Ÿé€»è¾‘ï¼‰
    function renderEvalOptions() {
        const options = ["éå¸¸æ»¡æ„è¿™æ¬¡æœåŠ¡ Very satisfied with this service", "è½¬äººå·¥ Transfer to human", "éå¸¸ä¸æ»¡æ„ Very dissatisfied"];
        const container = document.createElement('div');
        container.className = 'options-container';
        
        options.forEach(opt => {
            const btn = document.createElement('button');
            btn.className = 'opt-btn';
            btn.innerText = opt;
            btn.onclick = () => handleEvalChoice(opt, container);
            container.appendChild(btn);
        });
        chatArea.appendChild(container);
        scrollToBottom();
    }

    // æ–°å¢ï¼šå¤„ç†è¯„ä»·æŒ‰é’®çš„ç‚¹å‡»
    async function handleEvalChoice(choice, container) {
        if(isWaiting) return;
        
        // ç¦ç”¨å½“å‰è¿™ä¸€ç»„çš„æŒ‰é’®
        Array.from(container.children).forEach(b => b.classList.add('disabled'));
        addMessage(choice, "user");
        
        await showTypingDelay();

        if (choice === "éå¸¸æ»¡æ„è¿™æ¬¡æœåŠ¡ Very satisfied with this service") {
            addMessage("æ„Ÿè°¢æ‚¨çš„å’¨è¯¢ï¼Œæœ€æ–°ä¼˜æƒ å·²å‘è‡³ä¸ªäººè´¦æˆ·ï¼Œè¯·æ‚¨è‡ªè¡ŒæŸ¥è¯¢ Thank you for your inquiry. The latest offers have been sent to your personal account. Please check them yourself.", "bot");
            // æµç¨‹åˆ°æ­¤ç»“æŸï¼Œç•Œé¢å¡æ­»ï¼Œå½»åº•æ¶å¿ƒç”¨æˆ·
            
        } else if (choice === "è½¬äººå·¥ Transfer to human") {
            addMessage(`å·²ä¸ºæ‚¨è½¬æ¥äººå·¥å®¢æœï¼Œäººå·¥å®¢æœæ’é˜Ÿä¸­ï¼Œæ‚¨æ’åœ¨ã€${queueNumber}ã€‘ï¼Œè¯·æ‚¨è€å¿ƒç­‰å¾…ã€‚You have been transferred to a human customer service representative. The human customer service is currently in queue, and you are in position ã€${queueNumber}ã€‘. Please be patient.`, "bot");
            queueNumber--; // æ•°å­—å‡ 1
            // å†æ¬¡æ¸²æŸ“è¯„ä»·æŒ‰é’®ï¼Œè®©ç”¨æˆ·å¯ä»¥ç»§ç»­ç»æœ›åœ°ç‚¹å‡»â€œè½¬äººå·¥â€
            renderEvalOptions();
            
        } else if (choice === "éå¸¸ä¸æ»¡æ„ Very dissatisfied") {
            // è§¦å‘ 5 ç§’å¼ºåˆ¶é‡å¯å¾ªç¯
            triggerResetLoop();
        }
    }

    function triggerResetLoop() {
        overlay.style.display = 'block'; // é˜»æ­¢ç”¨æˆ·äº¤äº’
        let countdown = 5;
        
        const sysMsg = document.createElement('div');
        sysMsg.style.textAlign = 'center';
        sysMsg.style.color = '#999';
        sysMsg.style.fontSize = '12px';
        sysMsg.style.marginTop = '10px';
        chatArea.appendChild(sysMsg);
        
        const timer = setInterval(() => {
            sysMsg.innerText = `ç³»ç»Ÿå†…å­˜è¿‡è½½ï¼Œ${countdown} ç§’åå¼ºåˆ¶é‡å¯... The system is overloaded, forcing restart in ${countdown} seconds...`;
            scrollToBottom();
            countdown--;
            if (countdown < 0) {
                clearInterval(timer);
                resetScene(currentScene, true);
            }
        }, 1000); // [cite: 17]
    }

    // é‡ç½®æˆ–åˆ‡æ¢åœºæ™¯
    async function resetScene(sceneId, isLoopReset = false) {
        chatArea.innerHTML = '';
        currentStepIndex = -1;
        isWaiting = false;
        overlay.style.display = 'none';
        
        textInput.disabled = true;
        textInput.placeholder = "è¯·å…ˆé€‰æ‹©ä¸Šæ–¹é—®é¢˜ Please select a question above"; 
        textInput.value = '';
        sendBtn.style.display = 'none';

        if (isLoopReset) {
            addMessage("æ‚¨å¥½ï¼Œåˆšæ‰ç”±äºç³»ç»Ÿä¼¤å¿ƒè¿‡åº¦å†…å­˜è¿‡è½½ï¼Œä½†æˆ‘å¿˜è®°äº†æ‰€æœ‰çš„ä¸æ„‰å¿«ï¼Œè¯·é‡æ–°å¼€å§‹æ‚¨çš„å—æŒ«ä¹‹æ—…ã€‚Hello, I'm sorry for the inconvenience caused by the system overload. Please start your frustrating journey again.", 'bot');
        } else {
            addMessage(`æ‚¨å¥½ï¼Œæ¬¢è¿è¿›å…¥æ™ºèƒ½å®¢æœã€‚è¯·é€‰æ‹©æ‚¨è¦åŠç†çš„ä¸šåŠ¡ï¼šHello, welcome to intelligent custormer service. Please select the business you want to handle:`, 'bot');
        }

        // ã€ä¿®æ”¹ç‚¹ã€‘ï¼šç›´æ¥ä» scenes é…ç½®ä¸­è¯»å–åˆå§‹æŒ‰é’®ï¼Œä¸å†éœ€è¦æ‰‹å†™ if-else åˆ¤æ–­
        const initialButtons = scenes[sceneId].initialOpts || [];
        renderOptions(initialButtons);
    }

    // åˆ‡æ¢é¡¶éƒ¨ Tab [cite: 7]
    function switchScene(sceneId) {
        if (isWaiting || overlay.style.display === 'block') return; // é˜»æ–­åˆ‡æ¢
        
        currentScene = sceneId;
        document.getElementById('scene-title').innerText = scenes[sceneId].title; // [cite: 22]
        
        // æ›´æ–° Tab æ ·å¼
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.getElementById(`tab-${sceneId}`).classList.add('active');

        resetScene(sceneId);
    }

    // ç»‘å®šå›è½¦å‘é€äº‹ä»¶
    textInput.addEventListener('keypress', function (e) {
        if (e.key === 'Enter') handleSendText();
    });

    // åˆå§‹åŒ–è¿è¡Œ
    window.onload = async () => {
        // å…ˆåŠ è½½ CSV æ•°æ®
        await loadKeywordsFromCSV();
        // æ•°æ®åŠ è½½å®Œåå†å¯åŠ¨åœºæ™¯
        resetScene('finance');
    };

</script>
</body>
</html>